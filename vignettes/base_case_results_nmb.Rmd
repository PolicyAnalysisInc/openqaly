---
title: "Base Case Results - Net Monetary Benefit"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Base Case Results - Net Monetary Benefit}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

This vignette demonstrates how to visualize and summarize net monetary benefit (NMB) from model results using openqaly. The examples use a sample model included with the package.

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup, include = FALSE}
library(openqaly)

model <- read_model(system.file("models", "checkimab", package = "openqaly"))

results <- run_model(model)
```

## NMB Visualization

The `nmb_plot_bar()` function creates bar charts showing NMB components (health benefits, costs, and net benefit) for strategy comparisons. Results can be filtered by strategy and population subgroup.

### Bar Charts

The following examples demonstrate bar charts for NMB visualization.

#### Overall population

```{r, fig.width=9, fig.height=6}
nmb_plot_bar(
  results,
  health_outcome = "qalys",
  cost_outcome = "costs",
  interventions = "check"
)
```

#### By subgroup

Use `groups = 'all'` to display results for each population subgroup separately.

```{r, fig.width=9, fig.height=6}
nmb_plot_bar(
  results,
  health_outcome = "qalys",
  cost_outcome = "costs",
  interventions = "check",
  groups = "all"
)
```

#### Filtering to specific comparisons

Use the `comparators` argument to compare against a specific reference strategy.

```{r, fig.width=9, fig.height=6}
nmb_plot_bar(
  results,
  health_outcome = "qalys",
  cost_outcome = "costs",
  interventions = "check",
  comparators = "chemo"
)
```

Multiple interventions can be compared against the same comparator.

```{r, fig.width=9, fig.height=6}
nmb_plot_bar(
  results,
  health_outcome = "qalys",
  cost_outcome = "costs",
  comparators = "chemo"
)
```

### NMB Over Time

The `nmb_plot_line()` function displays how NMB accumulates over the model time horizon.

```{r, fig.width=9, fig.height=6}
nmb_plot_line(
  results,
  health_outcome = "qalys",
  cost_outcome = "costs",
  comparators = "chemo"
)
```

## NMB Tables

The `nmb_table()` function presents NMB values in tabular format.

### Overall population

```{r}
nmb_table(
  results,
  health_outcome = "qalys",
  cost_outcome = "costs",
  interventions = "check"
)
```

### By subgroup

```{r}
nmb_table(
  results,
  health_outcome = "qalys",
  cost_outcome = "costs",
  interventions = "check",
  groups = "all"
)
```

### Differences vs comparator

```{r}
nmb_table(
  results,
  health_outcome = "qalys",
  cost_outcome = "costs",
  interventions = "check",
  comparators = "chemo"
)
```
