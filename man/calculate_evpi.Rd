% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/ceac.R
\name{calculate_evpi}
\alias{calculate_evpi}
\title{Calculate Expected Value of Perfect Information (EVPI)}
\usage{
calculate_evpi(
  results,
  outcome_summary,
  cost_summary,
  wtp = seq(0, 1e+05, by = 5000),
  group = "aggregated",
  strategies = NULL,
  discounted = FALSE
)
}
\arguments{
\item{results}{A openqaly PSA results object (from run_psa)}

\item{outcome_summary}{Name of the outcome summary to use (e.g., "total_qalys")}

\item{cost_summary}{Name of the cost summary to use (e.g., "total_cost")}

\item{wtp}{Numeric vector of WTP thresholds to evaluate. Default is
seq(0, 100000, by = 5000)}

\item{group}{Group selection: "aggregated" (default) uses aggregated results,
specific group name filters to that group, NULL or "all" includes all groups
(triggers separate calculations per group)}

\item{strategies}{Character vector of strategy names to include (NULL for all)}

\item{discounted}{Logical. Use discounted values? (default: FALSE)}
}
\value{
A tibble with columns:
  \item{wtp}{Willingness-to-pay threshold}
  \item{evpi}{Expected value of perfect information}
  \item{group}{Group name (if applicable)}
}
\description{
Calculates the Expected Value of Perfect Information from probabilistic
sensitivity analysis results. EVPI represents the expected value of
eliminating all parameter uncertainty - the maximum amount a decision-maker
should be willing to pay for perfect information about all uncertain parameters.
}
\details{
EVPI is calculated using the following algorithm:

1. For each WTP threshold:
   - Calculate NMB for each strategy in each simulation: NMB = outcome * wtp - cost
   - Identify the strategy with highest expected NMB across all simulations (overall optimal)
   - For each simulation, find the strategy with highest NMB (optimal with perfect information)
   - Calculate the opportunity loss: max(0, NMB_sim_optimal - NMB_sim_overall_optimal)
   - EVPI = mean opportunity loss across all simulations

EVPI represents the expected cost of making decisions under uncertainty. It provides
an upper bound on the value of conducting further research to reduce uncertainty.

When EVPI = 0, the same strategy is optimal in all simulations (no uncertainty
affects the decision). Higher EVPI indicates greater decision uncertainty and
potentially higher value of additional research.

When multiple groups are present, EVPI is calculated separately for each group.
}
\examples{
\dontrun{
model <- read_model(system.file("models/example_psm", package = "openqaly"))
psa_results <- run_psa(model, n_sim = 1000)

# Calculate EVPI
evpi <- calculate_evpi(psa_results, "total_qalys", "total_cost")

# Custom WTP range
evpi <- calculate_evpi(psa_results, "total_qalys", "total_cost",
                       wtp = seq(0, 200000, by = 10000))
}

}
