% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/model_builder.R
\name{add_multivariate_sampling}
\alias{add_multivariate_sampling}
\title{Add Multivariate Sampling Specification to Model}
\usage{
add_multivariate_sampling(
  model,
  name,
  distribution,
  variables,
  description = NULL
)
}
\arguments{
\item{model}{A oq_model_builder object}

\item{name}{Character string naming this sampling specification}

\item{distribution}{Expression defining the distribution function (uses NSE).
The distribution should return a function(n) that generates n Ã— k samples.
Can reference any evaluated variables including base case values of sampled variables.
For backward compatibility, can also be a character string.}

\item{variables}{Character vector of variable names to be sampled together,
or a tibble with columns: variable, strategy, group (for segment-specific sampling)}

\item{description}{Optional description of this sampling specification}
}
\value{
The modified model object
}
\description{
Define a multivariate distribution for sampling correlated parameters.
This is used for Probabilistic Sensitivity Analysis (PSA) when multiple
parameters need to be sampled together with a specified correlation structure.
}
\examples{
\dontrun{
# Dirichlet distribution for transition probabilities
model <- define_model("markov") |>
  add_multivariate_sampling(
    name = "transition_probs",
    distribution = dirichlet(c(alpha_stable, alpha_progression, alpha_death)),
    variables = c("p_stable", "p_progression", "p_death"),
    description = "Transition probabilities from sick state"
  )

# Multivariate normal for correlated cost and effectiveness
model <- model |>
  add_multivariate_sampling(
    name = "cost_qaly_correlation",
    distribution = mvnormal(mean = c(bc_cost, bc_qaly), sd = c(se_cost, se_qaly), cor = 0.6),
    variables = c("cost_treatment", "qaly_treatment")
  )

# Segment-specific sampling with tibble specification
model <- model |>
  add_multivariate_sampling(
    name = "strategy_specific",
    distribution = mvnormal(mean = c(cost_mean, qaly_mean), sd = c(cost_sd, qaly_sd), cor = 0.5),
    variables = tibble(
      variable = c("treatment_cost", "treatment_qaly"),
      strategy = c("intervention", "intervention"),
      group = c(NA, NA)
    )
  )
}
}
